# 1.2_task - Migração de Schema e Dados (Faseada)

## Objetivo
- Reestruturar a tabela `Prazo` para remover a dependência de `Publicacao` e estabelecer o vínculo obrigatório com `Processo`.

## Escopo / Entregáveis
- Script SQL de migração contendo as 3 fases (Estrutura, Backfill, Limpeza).

## Passos e subtarefas
- [ ] 1.2.1: **Fase 1 (Estrutura)**: Adicionar colunas `processoid` (UUID/INT) e `status_id` (UUID) como anuláveis na tabela `Prazo`.
- [ ] 1.2.2: **Fase 2 (Backfill)**:
    - Preencher `processoid` via JOIN com `Publicacao`.
    - Preencher `status_id` com o ID do status 'pendente'.
    - Identificar e remover prazos órfãos (sem processo associado).
- [ ] 1.2.3: **Fase 3 (Limpeza)**:
    - Aplicar restrição `NOT NULL` em `processoid` e `status_id`.
    - Remover coluna `publicacaoid` e índices associados.
    - Criar novo índice em `(tenant_id, processoid)`.

## Dependências
- [x] Task 1.1 (Necessário ter os status criados para o backfill).

## Paralelizável?
- Não. Esta tarefa deve ser executada de forma sequencial após a Task 1.1.

## Critérios de aceite
- Tabela `Prazo` não deve possuir a coluna `publicacaoid`.
- Todos os prazos devem estar vinculados a um `processoid`.
- Consultas por `processoid` devem ser performáticas devido ao novo índice.

## Testes
- Verificar se a coluna `publicacaoid` foi removida.
- Validar se não existem registros com `processoid` ou `status_id` nulos.
- Testar a integridade referencial das novas FKs.

## Notas
- Realizar backup dos dados antes de executar a migração.
- Executar em ambiente de staging antes da produção.
